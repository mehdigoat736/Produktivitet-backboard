<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student OS // Pro Edition</title>
    
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        /* --- DESIGN SYSTEM --- */
        :root {
            --bg-dark: #0f172a;
            --bg-darker: #020617;
            --glass: rgba(30, 41, 59, 0.7);
            --glass-hover: rgba(51, 65, 85, 0.8);
            --border: rgba(255, 255, 255, 0.08);
            --primary: #8b5cf6; /* Violet */
            --accent: #06b6d4;  /* Cyan */
            --text: #f8fafc;
            --text-dim: #94a3b8;
            --success: #10b981;
        }

        * { box-sizing: border-box; outline: none; }

        body {
            margin: 0;
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-darker);
            color: var(--text);
            height: 100vh;
            overflow: hidden;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(139, 92, 246, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(6, 182, 212, 0.15) 0%, transparent 40%);
        }

        /* --- LAYOUT --- */
        .app-container {
            display: grid;
            grid-template-columns: 260px 1fr;
            height: 100vh;
            max-width: 1600px;
            margin: 0 auto;
        }

        /* --- SIDEBAR --- */
        .sidebar {
            background: rgba(15, 23, 42, 0.5);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--border);
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .profile-area {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        .avatar {
            width: 80px; height: 80px; border-radius: 20px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            margin: 0 auto 15px; padding: 2px;
        }
        .avatar img { width: 100%; height: 100%; border-radius: 18px; background: #000; }

        .level-badge {
            background: rgba(255,255,255,0.1); padding: 4px 12px;
            border-radius: 12px; font-size: 0.75rem; font-weight: 700;
            color: var(--accent); display: inline-block; margin-top: 5px;
        }

        .nav-btn {
            background: transparent; border: none; color: var(--text-dim);
            padding: 15px; border-radius: 15px; cursor: pointer;
            text-align: left; font-size: 1rem; font-weight: 500;
            display: flex; align-items: center; gap: 15px;
            transition: 0.3s;
        }
        .nav-btn i { font-size: 1.4rem; }
        .nav-btn:hover { background: rgba(255,255,255,0.05); color: white; }
        .nav-btn.active { background: linear-gradient(90deg, rgba(139, 92, 246, 0.2), transparent); color: var(--primary); border-left: 3px solid var(--primary); }

        /* --- MAIN CONTENT --- */
        .main-content {
            padding: 40px;
            overflow-y: auto;
            position: relative;
        }

        .section { display: none; animation: fadeIn 0.4s ease; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- DASHBOARD WIDGETS --- */
        .grid-layout {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px;
        }

        .card {
            background: var(--glass); backdrop-filter: blur(15px);
            border: 1px solid var(--border); border-radius: 24px; padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transition: transform 0.3s ease;
        }
        .card:hover { transform: translateY(-3px); border-color: rgba(255,255,255,0.2); }

        h2 { margin-top: 0; font-weight: 700; display: flex; align-items: center; gap: 10px; }

        /* Timer Styles */
        .timer-big {
            font-size: 5rem; font-weight: 800; text-align: center;
            background: linear-gradient(to right, #fff, var(--accent));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin: 20px 0; font-variant-numeric: tabular-nums;
        }
        .btn-primary {
            background: var(--primary); color: white; border: none; width: 100%;
            padding: 15px; border-radius: 15px; font-weight: 700; cursor: pointer;
            box-shadow: 0 5px 20px rgba(139, 92, 246, 0.4); transition: 0.2s;
        }
        .btn-primary:active { transform: scale(0.98); }

        /* Task Styles */
        .task-input {
            width: 100%; background: rgba(0,0,0,0.3); border: 1px solid var(--border);
            padding: 12px; border-radius: 12px; color: white; margin-bottom: 15px;
        }
        .task-item {
            background: rgba(255,255,255,0.05); padding: 12px; border-radius: 12px;
            margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;
            cursor: pointer; transition: 0.2s;
        }
        .task-item:hover { background: rgba(255,255,255,0.1); }
        .verified-badge { font-size: 0.7rem; color: var(--success); background: rgba(16, 185, 129, 0.15); padding: 2px 8px; border-radius: 6px; }

        /* --- TOOLS SECTION --- */
        .tool-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; }
        
        /* Calculator */
        .calc-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 15px; }
        .calc-btn {
            background: rgba(255,255,255,0.1); border: none; color: white;
            padding: 15px; border-radius: 10px; font-size: 1.2rem; cursor: pointer;
        }
        .calc-btn.op { background: rgba(139, 92, 246, 0.2); color: var(--primary); }
        .calc-display {
            width: 100%; background: black; color: var(--accent); font-family: monospace;
            font-size: 2rem; text-align: right; padding: 15px; border-radius: 10px; border: none;
        }

        /* Notepad */
        #notepad {
            width: 100%; height: 300px; background: rgba(0,0,0,0.3); border: 1px solid var(--border);
            color: #ddd; padding: 20px; border-radius: 15px; resize: none; line-height: 1.6;
        }

    </style>
</head>
<body>

<div class="app-container">
    
    <nav class="sidebar">
        <div class="profile-area">
            <div class="avatar">
                <img id="avatarImg" src="" alt="Avatar">
            </div>
            <h3 id="usernameDisplay" style="margin:0">Elev</h3>
            <div class="level-badge" id="levelDisplay">Level 1: Nybegynner</div>
        </div>

        <button class="nav-btn active" onclick="showSection('dashboard')">
            <i class="ph ph-squares-four"></i> Dashboard
        </button>
        <button class="nav-btn" onclick="showSection('tasks')">
            <i class="ph ph-check-square"></i> Oppgaver
        </button>
        <button class="nav-btn" onclick="showSection('tools')">
            <i class="ph ph-calculator"></i> VerktÃ¸y
        </button>
        <button class="nav-btn" onclick="resetProgress()" style="margin-top:auto; color: #ef4444;">
            <i class="ph ph-trash"></i> Nullstill
        </button>
    </nav>

    <main class="main-content">
        
        <section id="dashboard" class="section active">
            <h1 style="margin-bottom: 5px;">Velkommen tilbake! ðŸ‘‹</h1>
            <p style="color: var(--text-dim); margin-bottom: 30px;">Her er dagens oversikt.</p>

            <div class="grid-layout">
                <div class="card" style="text-align: center;">
                    <h2><i class="ph ph-clock"></i> Fokus Ã˜kt</h2>
                    <div class="timer-big" id="time">25:00</div>
                    <button class="btn-primary" id="timerBtn" onclick="toggleTimer()">START FOKUS</button>
                    <p style="font-size: 0.8rem; margin-top: 15px; opacity: 0.7;">Husk Ã¥ ta pauser!</p>
                </div>

                <div class="card">
                    <h2><i class="ph ph-chart-bar"></i> Min Aktivitet</h2>
                    <canvas id="xpChart" height="180"></canvas>
                </div>

                <div class="card" style="background: linear-gradient(135deg, #1e1b4b, #312e81);">
                    <h2><i class="ph ph-headphones"></i> LoFi Radio</h2>
                    <div style="display:flex; align-items:center; justify-content:center; height: 100px; gap: 10px;">
                        <div class="bar" style="width:5px; height:20px; background:var(--accent); animation: bounce 1s infinite;"></div>
                        <div class="bar" style="width:5px; height:35px; background:var(--primary); animation: bounce 1.2s infinite;"></div>
                        <div class="bar" style="width:5px; height:15px; background:white; animation: bounce 0.8s infinite;"></div>
                    </div>
                    <button class="btn-primary" style="background:rgba(255,255,255,0.1);" onclick="alert('Spiller LoFi Beats for Studying...')">â–¶ SPILLELISTE</button>
                </div>
            </div>
        </section>

        <section id="tasks" class="section">
            <h1>Mine MÃ¥l</h1>
            <div class="card" style="max-width: 600px;">
                <input type="text" class="task-input" id="taskInput" placeholder="Hva skal du lÃ¦re i dag? Trykk Enter...">
                <div id="taskList">
                    </div>
            </div>
        </section>

        <section id="tools" class="section">
            <h1>SkoleverktÃ¸y</h1>
            <div class="tool-grid">
                <div class="card">
                    <h2><i class="ph ph-calculator"></i> Kalkulator</h2>
                    <input type="text" class="calc-display" id="calcDisplay" readonly>
                    <div class="calc-grid">
                        <button class="calc-btn" onclick="calc('7')">7</button>
                        <button class="calc-btn" onclick="calc('8')">8</button>
                        <button class="calc-btn" onclick="calc('9')">9</button>
                        <button class="calc-btn op" onclick="calc('/')">/</button>
                        <button class="calc-btn" onclick="calc('4')">4</button>
                        <button class="calc-btn" onclick="calc('5')">5</button>
                        <button class="calc-btn" onclick="calc('6')">6</button>
                        <button class="calc-btn op" onclick="calc('*')">*</button>
                        <button class="calc-btn" onclick="calc('1')">1</button>
                        <button class="calc-btn" onclick="calc('2')">2</button>
                        <button class="calc-btn" onclick="calc('3')">3</button>
                        <button class="calc-btn op" onclick="calc('-')">-</button>
                        <button class="calc-btn" onclick="calc('0')">0</button>
                        <button class="calc-btn" onclick="calc('C')">C</button>
                        <button class="calc-btn op" onclick="solve()">=</button>
                        <button class="calc-btn op" onclick="calc('+')">+</button>
                    </div>
                </div>

                <div class="card">
                    <h2><i class="ph ph-notebook"></i> Notatblokk</h2>
                    <textarea id="notepad" placeholder="Skriv notater her... de lagres automatisk!"></textarea>
                </div>
            </div>
        </section>

    </main>
</div>

<audio id="alarm" src="https://assets.mixkit.co/sfx/preview/mixkit-positive-notification-951.mp3"></audio>

<script>
    // --- 1. CONFIG & STATE ---
    let state = {
        xp: 0,
        level: 1,
        tasks: [],
        notes: "",
        weeklyXP: [100, 350, 200, 500, 300, 150, 0] // Demo data
    };

    // Load Data
    if(localStorage.getItem('studentOS')) {
        state = {...state, ...JSON.parse(localStorage.getItem('studentOS'))};
    }

    // Avatar Generator (DiceBear API)
    const seed = Math.floor(Math.random() * 1000);
    document.getElementById('avatarImg').src = `https://api.dicebear.com/7.x/bottts/svg?seed=${state.xp}`;

    // --- 2. NAVIGATION ---
    function showSection(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        // Enkel logikk for aktiv knapp styling
        if(id === 'dashboard') document.querySelector('.nav-btn:nth-child(2)').classList.add('active');
        if(id === 'tasks') document.querySelector('.nav-btn:nth-child(3)').classList.add('active');
        if(id === 'tools') document.querySelector('.nav-btn:nth-child(4)').classList.add('active');
    }

    // --- 3. TIMER LOGIC ---
    let timerRef = null;
    let timeLeft = 25 * 60;
    let isRunning = false;
    const timeDisplay = document.getElementById('time');
    const timerBtn = document.getElementById('timerBtn');

    function toggleTimer() {
        if (isRunning) {
            clearInterval(timerRef);
            timerBtn.innerText = "FORTSETT";
            timerBtn.style.background = "var(--primary)";
        } else {
            timerBtn.innerText = "PAUSE";
            timerBtn.style.background = "#ef4444";
            timerRef = setInterval(() => {
                timeLeft--;
                const m = Math.floor(timeLeft / 60);
                const s = timeLeft % 60;
                timeDisplay.innerText = `${m}:${s < 10 ? '0' : ''}${s}`;
                if (timeLeft <= 0) completeSession();
            }, 1000);
        }
        isRunning = !isRunning;
    }

    function completeSession() {
        clearInterval(timerRef);
        document.getElementById('alarm').play();
        confetti({ particleCount: 200, spread: 100 });
        alert("Bra jobba! Du fullfÃ¸rte en Ã¸kt! +250 XP");
        addXP(250);
        timeLeft = 25 * 60;
        timeDisplay.innerText = "25:00";
        timerBtn.innerText = "START FOKUS";
        isRunning = false;
    }

    // --- 4. GAMIFICATION (XP & LEVEL) ---
    function addXP(amount) {
        state.xp += amount;
        state.level = Math.floor(state.xp / 1000) + 1;
        state.weeklyXP[6] += amount; // Legger til i dagens graf
        save();
        updateProfile();
    }

    function updateProfile() {
        const titles = ["Nybegynner", "Student", "LÃ¦rling", "Akademiker", "Master", "Genius"];
        const title = titles[Math.min(state.level - 1, titles.length - 1)];
        document.getElementById('levelDisplay').innerText = `Level ${state.level}: ${title} (${state.xp} XP)`;
        updateChart();
    }

    // --- 5. TASKS ---
    const taskInput = document.getElementById('taskInput');
    const taskList = document.getElementById('taskList');

    // Render saved tasks
    state.tasks.forEach(t => renderTask(t));

    taskInput.addEventListener('keypress', (e) => {
        if(e.key === 'Enter' && e.target.value.trim()) {
            const task = { text: e.target.value, id: Date.now() };
            state.tasks.push(task);
            save();
            renderTask(task);
            e.target.value = '';
        }
    });

    function renderTask(task) {
        const div = document.createElement('div');
        div.className = 'task-item';
        div.innerHTML = `
            <span>${task.text}</span>
            <span class="verified-badge">MÃ¥l</span>
        `;
        div.onclick = () => {
            div.style.opacity = 0;
            setTimeout(() => {
                div.remove();
                state.tasks = state.tasks.filter(t => t.id !== task.id);
                addXP(50); // XP for Ã¥ fullfÃ¸re oppgave
                save();
            }, 300);
        };
        taskList.prepend(div);
    }

    // --- 6. TOOLS (Calc & Notepad) ---
    // Notepad
    const notepad = document.getElementById('notepad');
    notepad.value = state.notes;
    notepad.addEventListener('input', (e) => {
        state.notes = e.target.value;
        save();
    });

    // Calculator
    let calcStr = "";
    function calc(val) {
        if(val === 'C') { calcStr = ""; }
        else { calcStr += val; }
        document.getElementById('calcDisplay').value = calcStr;
    }
    function solve() {
        try {
            calcStr = eval(calcStr).toString();
            document.getElementById('calcDisplay').value = calcStr;
        } catch(e) {
            document.getElementById('calcDisplay').value = "Error";
            calcStr = "";
        }
    }

    // --- 7. SYSTEM FUNCTIONS ---
    function save() {
        localStorage.setItem('studentOS', JSON.stringify(state));
    }

    function resetProgress() {
        if(confirm("Er du sikker pÃ¥ at du vil slette all fremgang?")) {
            localStorage.removeItem('studentOS');
            location.reload();
        }
    }

    // --- 8. CHART SETUP ---
    let chart;
    function initChart() {
        const ctx = document.getElementById('xpChart').getContext('2d');
        chart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Man', 'Tir', 'Ons', 'Tor', 'Fre', 'LÃ¸r', 'SÃ¸n'],
                datasets: [{
                    label: 'XP opptjent',
                    data: state.weeklyXP,
                    backgroundColor: '#8b5cf6',
                    borderRadius: 8
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: false } },
                scales: {
                    x: { grid: { display: false }, ticks: { color: '#94a3b8' } },
                    y: { display: false }
                }
            }
        });
    }

    function updateChart() {
        if(chart) {
            chart.data.datasets[0].data = state.weeklyXP;
            chart.update();
        }
    }

    // Start
    updateProfile();
    initChart();
    
    // Keyframes for animations injected here for simplicity
    const styleSheet = document.createElement("style");
    styleSheet.innerText = `
        @keyframes bounce { 0%, 100% { height: 10px; } 50% { height: 30px; } }
    `;
    document.head.appendChild(styleSheet);

</script>
</body>
</html>
